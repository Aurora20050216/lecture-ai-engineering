# 要件定義書  
## 講義書き起こし修正AI

---

## 1. 目的・背景

講義の自動書き起こし結果は、ドメイン固有語の誤認識、言い直し、どもりなどが多く、読みやすい文章とは言い難い。  
本プロジェクトでは、講義スライド資料（.pptx）を併用し、Bedrock上のLLMによって自動修正を行い、自然で読みやすい文章に修正することを目的とする。

---

## 2. 対象ユーザー

- 教員：講義内容の書き起こしを行う担当者

---

## 3. システム概要

### 概要  
ユーザーが `.txt`（文字起こし）と`.pptx`（講義資料）をアップロードすると、整形された `.txt` ファイルがダウンロード可能になる。

### 流れ

```plaintext
[INPUT]
・講義資料（.pptx）1件
・文字起こしファイル（.txt）1件

        ↓

[処理内容]
1. .pptxファイルからスライドテキストを抽出(python-pptxを使用)
2. .txtファイルの発話をチャンクに分割（500文字単位）
3. 各チャンクと全スライド文の類似度をAmazon Titan Embeddingにより計算し、最も近いスライドを選択
4. 選択したスライド文とチャンクをセットで、Claude 3.5 Sonnet(Bedrock)に渡して修正処理を実行
5. 修正済みのチャンクを結語委s、1つのテキストとして出力
6. テキストファイルをS3に保存し、ダウンロードURLを発行

        ↓

[OUTPUT]
・修正済みの文字起こしファイル（.txt）1件
```

---

## 4. 機能要件

### 入力ファイル

| 種別           | 拡張子 | 内容                              |
|----------------|--------|----------------------------------|
| 講義資料       | `.pptx`| スライドテキスト                 |
| 音声文字起こし | `.txt` | 自動書き起こし結果の連続文（句読点なし可）  |

### 出力ファイル

| 種別          | 拡張子 | 内容                           |
|---------------|--------|-------------------------------|
| 修正済講義文  | `.txt` | 読みやすい句読点付き整形文（スライド準拠） |

---

## 5. 非機能要件

- **処理性能**  
  2時間分の講義データ（約40,000〜50,000文字）を5時間以内に整形処理完了  
- **同時処理数**  
  初期は1件対応、将来的には並列API連携によりバッチ化を検討。
- **可用性**  
  非同期バッチ処理方式。処理完了後、ファイルをS3等からダウンロード可能  
- **拡張性**  
  複数スライドファイル、複数講義対応を将来的に考慮  

---

## 6. 使用技術スタック

| 項目           | 技術・サービス                        |
|----------------|-------------------------------------|
| LLM            | Bedrock (Claude 3.5 Sonnet)         |
| 類似度評価     | Titan Embeddings(Bedrock)           |
| 埋め込みベクトル計算 | `amazon.titan-embed-text-v2:0`(bedrock経由) |
| スライド解析   | `python-pptx`                       |
| バックエンド   | FastAPI  |
| フロントエンド | HTML + JavaScript |
| ストレージ     | Amazon S3                          |
| 認証・アクセス管理 | IAM権限管理 |

---

## 7. LLMプロンプト設計（概要）

```plaintext
### Instruction:
以下は講義の文字起こしです。この文章には口語、言い直し、どもりなどが含まれています。
以下の制約のもとで、内容を要約せず、忠実に保ちながら、文法的に正しい自然な文章に整えてください。

- 話の順番、内容、意味を変えないでください。
- 話者の言い間違いや、口語表現は適切に直してください。
- 固有名詞の誤った文字起こしを修正する際はスライドを参考にしてください。
- 「えー」「あのー」などの無意味語は取り除いてください。
- 要約はせず、原文の流れを保ってください。
- タイムスタンプはそのままで良いです。
- 「以下は、講義の文字起こしを文法的に正しい自然な文章に整えたものです：」など言わずに、修正結果のみを返してください。
- これはある1つの長い文章を小分けにして送っています。最後に結合するので、毎回最後に改行を入れないようにしてもらえると、結合をしやすいです。

修正の例：
修正前：このようなモデルどのように学習しますかという話なんですが、ネクストtokenフリクションといって未来の位置一つ先のtoken単語を当てる学習をすることによって、言語モデルがうまく文章をモデル化する性能を高めていきます。
修正後：このようなモデルどのように学習しますかという話なんですが、"next token prediction"といって未来の一つ先のtoken(単語)を当てる学習をすることによって、言語モデルがうまく文章をモデル化する性能を高めていきます。

修正前：次に既存の既にアカデミアでよく使うられるようなベンチマークで性能がどれほど出てるかというところも確認します。
修正後：次に既存の既にアカデミアでよく使われるようなベンチマークで性能がどれほど出てるかというところも確認します。

修正前：さて前向きが前置きが長くなってしまったんですが、これから本題学習済みモデルを活用する技術についてお話します大きく分けて二つ話します。
修正後：さて前置きが長くなってしまったんですが、これから本題、学習済みモデルを活用する技術について大きく分けて二つお話しします。

### Slide Content:
{slide_text}

### Original Transcript:
{transcript}

### Output:
{修正済み文章}
```

---

## 8. 評価方法

| 指標          | 方法                                       |
|---------------|--------------------------------------------|
| 類似度評価    | 修正後文とスライド文のBERTScore             |
| 文法品質      | LanguageToolなどで誤検出件数をカウント       |

---

## 9. スケジュール

| フェーズ               | 内容                               | 期間        |
|------------------------|----------------------------------|-------------|
| 設計・プロンプトチューニング | プロトタイプ開発・1講義で実験       | 3日    |
| MVP構築                | S3連携・Bedrock統合               | 2日    |
| デプロイ・評価         | 実運用評価・改善                   | 3日    |

---

## 10. 備考

- `.pptx`ファイルの構造によっては画像ベースのスライドには対応不可（OCR連携は別途検討）   

---

## 11. Webアプリケーション要件

### 11.1 入力UI

- ユーザーがブラウザ上で以下のファイルをアップロード可能  
  - 講義資料ファイル（`.pptx`）  
  - 文字起こしファイル（`.txt`）

- アップロードはそれぞれ1ファイルずつ（複数対応は将来検討）

### 11.2 バックエンド処理

- アップロードファイルはプリサインドURLを介してAmazon S3に一時保存される
- フロンドエンドから`FastAPI`の`/process_s3`エンドポイントを呼び出し、処理を開始
- 処理内容は以下の通り：
  1. `.pptx`からスライドテキスト抽出（`python-pptx`）
  2. `.txt`をチャンクに分割し、Titan Embeddingでベクトル化
  3. スライド文とチャンクを類似度マッチング（cos類似度）
  4. Claude 3.5に対応スライド文とチャンクを渡し整形
  5. 整形済みテキストを1ファイルに統合し、再度S3に保存

### 11.3 出力UI

- 処理完了後、整形済み `.txt` ファイルのダウンロードリンクを画面に表示  
- ダウンロードはワンクリックで実行可能 

### 11.4 システム構成

- フロントエンド：HTML + JavaScript
- バックエンド：FastAPI  
- ファイル保存：Amazon S3（入出力ファイル管理）  
- AI処理：Bedrock（Claude / Titan）

---

## 12. 制約事項

- Bedrockのリクエストにはスロット制限があり、過剰アクセス時はThrottlingが発生する。そのため、最大20回までの指数バックオフによるリトライ処理を実装。
- リトライ限界に達した場合はそのチャンクを処理せずエラーとする設計（今後の改善検討）。
- LLMモデルの応答には非決定性があり、同一プロンプトでも出力が変動する場合がある。

---

### バージョン情報

| バージョン | 日付       | 担当者   | 変更内容                      |
|------------|------------|----------|------------------------------|
| 1.0        | 2025-06-22 | Aurora20050216  | 初版作成                     |
| 1.1        | 2025-06-22 | Aurora20050216  | 書式修正                     |
| 2.0        | 2025-06-22 | Aurora20050216  | Webアプリケーション要件の追加  |
| 3.0        | 2025-06-22 | Aurora20050216  | 機能要件から「整形効果」の項目を削除  |
| 4.0        | 2025-06-29 | Aurora20050216  | 実装状況に合わせて設計・処理性能・UI進行度要件を調整  |